var I=Object.defineProperty;var L=Object.getOwnPropertySymbols;var U=Object.prototype.hasOwnProperty,A=Object.prototype.propertyIsEnumerable;var M=(t,o,s)=>o in t?I(t,o,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[o]=s,R=(t,o)=>{for(var s in o||(o={}))U.call(o,s)&&M(t,s,o[s]);if(L)for(var s of L(o))A.call(o,s)&&M(t,s,o[s]);return t};import{d as g,S as J}from"./index.e52e59a1.js";import{C as q,D as z,m as d,i as w,h as P,u as m,g as T,E as K,o as x,c as y,a as f,G as S,F as Q,b as Z,t as $,e as ee}from"./vendor.f376af20.js";function te(t){return q()?(z(t),!0):!1}const h=typeof window!="undefined",se=t=>typeof t=="string",N=()=>{};function k(t){var o;const s=m(t);return(o=s==null?void 0:s.$el)!=null?o:s}const _=h?window:void 0;h&&window.document;h&&window.navigator;h&&window.location;function v(...t){let o,s,e,n;if(se(t[0])?([s,e,n]=t,o=_):[o,s,e,n]=t,!o)return N;let i=N;const u=w(()=>m(o),a=>{i(),!!a&&(a.addEventListener(s,e,n),i=()=>{a.removeEventListener(s,e,n),i=N})},{immediate:!0,flush:"post"}),r=()=>{u(),i()};return te(r),r}function ne(t={}){const{touch:o=!0,resetOnTouchEnds:s=!1,initialValue:e={x:0,y:0},window:n=_}=t,i=d(e.x),u=d(e.y),r=d(null),a=p=>{i.value=p.pageX,u.value=p.pageY,r.value="mouse"},l=()=>{i.value=e.x,u.value=e.y},c=p=>{p.touches.length>0&&(i.value=p.touches[0].clientX,u.value=p.touches[0].clientY,r.value="touch")};return n&&(v(n,"mousemove",a,{passive:!0}),v(n,"dragover",a,{passive:!0}),o&&(v(n,"touchstart",c,{passive:!0}),v(n,"touchmove",c,{passive:!0}),s&&v(n,"touchend",l,{passive:!0}))),{x:i,y:u,sourceType:r}}function oe(t,o={}){const{handleOutside:s=!0,window:e=_}=o,{x:n,y:i,sourceType:u}=ne(o),r=d(t!=null?t:e==null?void 0:e.document.body),a=d(0),l=d(0),c=d(0),p=d(0),b=d(0),E=d(0),X=d(!1);let C=()=>{};return e&&(C=w([r,n,i],()=>{const B=k(r);if(!B)return;const{left:V,top:W,width:j,height:F}=B.getBoundingClientRect();c.value=V+e.pageXOffset,p.value=W+e.pageYOffset,b.value=F,E.value=j;const Y=n.value-c.value,O=i.value-p.value;X.value=Y<0||O<0||Y>E.value||O>b.value,(s||!X.value)&&(a.value=Y,l.value=O)},{immediate:!0})),{x:n,y:i,sourceType:u,elementX:a,elementY:l,elementPositionX:c,elementPositionY:p,elementHeight:b,elementWidth:E,isOutside:X,stop:C}}function ae(t={}){const{touch:o=!0,drag:s=!0,initialValue:e=!1,window:n=_}=t,i=d(e),u=d(null);if(!n)return{pressed:i,sourceType:u};const r=c=>()=>{i.value=!0,u.value=c},a=()=>{i.value=!1,u.value=null},l=P(()=>k(t.target)||n);return v(l,"mousedown",r("mouse"),{passive:!0}),v(n,"mouseleave",a,{passive:!0}),v(n,"mouseup",a,{passive:!0}),s&&(v(l,"dragstart",r("mouse"),{passive:!0}),v(n,"drop",a,{passive:!0}),v(n,"dragend",a,{passive:!0})),o&&(v(l,"touchstart",r("touch"),{passive:!0}),v(n,"touchend",a,{passive:!0}),v(n,"touchcancel",a,{passive:!0})),{pressed:i,sourceType:u}}var D;(function(t){t.UP="UP",t.RIGHT="RIGHT",t.DOWN="DOWN",t.LEFT="LEFT",t.NONE="NONE"})(D||(D={}));var G,H;h&&(window==null?void 0:window.navigator)&&((G=window==null?void 0:window.navigator)==null?void 0:G.platform)&&/iP(ad|hone|od)/.test((H=window==null?void 0:window.navigator)==null?void 0:H.platform);function ue(){const t=d(null),o=d(null),{pressed:s}=ae(),e=T({x:0,y:0,normX:0,normY:0,pressed:s,inside:!1});K(()=>{t.value.addEventListener("mousemove",n);const{isOutside:i}=oe(o);w(i,u=>{e.inside=!u})});function n(i,u=t.value,r=o.value){if(!u)return;var a=u.createSVGPoint();a.x=i.clientX,a.y=i.clientY;let l=a.matrixTransform(u.getScreenCTM().inverse());if(r){let c=r.getBBox();e.x=l.x<c.width?l.x<0?0:l.x:c.width,e.y=l.y<c.height?l.y<0?0:l.y:c.height,e.normY=1-e.y/c.height,e.normX=e.x/c.width}else e.x=l.x,e.y=l.y}return{svg:t,area:o,mouse:e}}function ie(){const{svg:t,area:o,mouse:s}=ue(),e=T({pair:null,num:null,pub:null,x:P(()=>s.normX),y:P(()=>1-s.normY)}),n=T({next:0,max:10,list:{}});g.get("playersNext").on(u=>n.next=u),g.get("players").map().on((u,r)=>{u!=null&&(n.list[r]=R({},u))});async function i(){e.pair=await J.pair(),e.pub=e.pair.pub,e.num=n.next%n.max;const u=g.get("players").get(e.num);w(s,a=>{u.put({x:a.normX,y:1-a.normY})}),setInterval(()=>{u.get("pulse").put(Date.now())},500);let r={pub:e.pair.pub,pulse:Date.now(),x:s.normX,y:1-s.normY};u.put(r),g.get("playersNext").put(e.num+1)}return{svg:t,area:o,players:n,my:e,join:i}}const re={class:"flex flex-col p-4"},le={class:"text-2xl font-bold"},ce=ee("Map"),de=["transform"],ve=f("circle",{fill:"red",r:"4"},null,-1),pe=[ve],fe={class:"players"},me=["transform"],he=f("circle",{r:"10"},null,-1),ge=[he],we={class:"p-4"},xe={class:"p-4"},Ee={setup(t){const{svg:o,area:s,my:e,players:n,join:i}=ie();return(u,r)=>(x(),y("div",re,[f("div",le,[ce,f("button",{class:"p-4 shadow-xl",onClick:r[0]||(r[0]=a=>m(i)())},"Join")]),(x(),y("svg",{class:"m-4 shadow-xl rounded-xl",ref:(a,l)=>{l.svg=a,S(o)&&(o.value=a)},version:"1.1",baseProfile:"full",viewBox:"0 0 1000 1000",xmlns:"http://www.w3.org/2000/svg","font-family":"Commissioner , sans-serif","text-anchor":"middle","dominant-baseline":"middle"},[f("rect",{ref:(a,l)=>{l.area=a,S(s)&&(s.value=a)},x:"2",y:"0",width:"1000",height:"1000",fill:"none","stroke-width":"0",opacity:"0.5"},null,512),f("g",{class:"me",transform:`translate(${m(e).x*1e3} ${m(e).y*1e3})`},pe,8,de),f("g",fe,[(x(!0),y(Q,null,Z(m(n).list,a=>(x(),y("g",{class:"player",key:a,transform:`translate(${a.x*1e3} ${a.y*1e3})`},ge,8,me))),128))])],512)),f("div",we,$(m(e)),1),f("div",xe,$(m(n)),1)]))}};export{Ee as default};
