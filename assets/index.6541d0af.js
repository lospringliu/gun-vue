var F=Object.defineProperty;var L=Object.getOwnPropertySymbols;var G=Object.prototype.hasOwnProperty,I=Object.prototype.propertyIsEnumerable;var M=(t,o,s)=>o in t?F(t,o,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[o]=s,R=(t,o)=>{for(var s in o||(o={}))G.call(o,s)&&M(t,s,o[s]);if(L)for(var s of L(o))I.call(o,s)&&M(t,s,o[s]);return t};import{d as h,S as U}from"./index.29c6ae5a.js";import{B as A,C as J,l as d,i as g,h as O,u as m,g as T,D as q,o as x,c as y,a as f,E as S,F as z,b as K,t as $,e as Q}from"./vendor.ce457e9e.js";function Z(t){return A()?(J(t),!0):!1}const N=typeof window!="undefined",ee=t=>typeof t=="string",P=()=>{};function k(t){var o;const s=m(t);return(o=s==null?void 0:s.$el)!=null?o:s}const w=N?window:void 0;N&&window.document;N&&window.navigator;function p(...t){let o,s,e,n;if(ee(t[0])?([s,e,n]=t,o=w):[o,s,e,n]=t,!o)return P;let r=P;const a=g(()=>m(o),u=>{r(),!!u&&(u.addEventListener(s,e,n),r=()=>{u.removeEventListener(s,e,n),r=P})},{immediate:!0,flush:"post"}),l=()=>{a(),r()};return Z(l),l}function te(t={}){const{touch:o=!0,resetOnTouchEnds:s=!1,initialValue:e={x:0,y:0},window:n=w}=t,r=d(e.x),a=d(e.y),l=d(null),u=v=>{r.value=v.pageX,a.value=v.pageY,l.value="mouse"},i=()=>{r.value=e.x,a.value=e.y},c=v=>{v.touches.length>0&&(r.value=v.touches[0].clientX,a.value=v.touches[0].clientY,l.value="touch")};return n&&(p(n,"mousemove",u,{passive:!0}),p(n,"dragover",u,{passive:!0}),o&&(p(n,"touchstart",c,{passive:!0}),p(n,"touchmove",c,{passive:!0}),s&&p(n,"touchend",i,{passive:!0}))),{x:r,y:a,sourceType:l}}function se(t,o={}){const{handleOutside:s=!0,window:e=w}=o,{x:n,y:r,sourceType:a}=te(o),l=d(t!=null?t:e==null?void 0:e.document.body),u=d(0),i=d(0),c=d(0),v=d(0),_=d(0),b=d(0),E=d(!1);let B=()=>{};return e&&(B=g([l,n,r],()=>{const C=k(l);if(!C)return;const{left:H,top:V,width:W,height:j}=C.getBoundingClientRect();c.value=H+e.pageXOffset,v.value=V+e.pageYOffset,_.value=j,b.value=W;const X=n.value-c.value,Y=r.value-v.value;E.value=X<0||Y<0||X>b.value||Y>_.value,(s||!E.value)&&(u.value=X,i.value=Y)},{immediate:!0})),{x:n,y:r,sourceType:a,elementX:u,elementY:i,elementPositionX:c,elementPositionY:v,elementHeight:_,elementWidth:b,isOutside:E,stop:B}}function ne(t={}){const{touch:o=!0,drag:s=!0,initialValue:e=!1,window:n=w}=t,r=d(e),a=d(null);if(!n)return{pressed:r,sourceType:a};const l=c=>()=>{r.value=!0,a.value=c},u=()=>{r.value=!1,a.value=null},i=O(()=>k(t.target)||n);return p(i,"mousedown",l("mouse"),{passive:!0}),p(n,"mouseleave",u,{passive:!0}),p(n,"mouseup",u,{passive:!0}),s&&(p(i,"dragstart",l("mouse"),{passive:!0}),p(n,"drop",u,{passive:!0}),p(n,"dragend",u,{passive:!0})),o&&(p(i,"touchstart",l("touch"),{passive:!0}),p(n,"touchend",u,{passive:!0}),p(n,"touchcancel",u,{passive:!0})),{pressed:r,sourceType:a}}var D;(function(t){t.UP="UP",t.RIGHT="RIGHT",t.DOWN="DOWN",t.LEFT="LEFT",t.NONE="NONE"})(D||(D={}));function oe(){const t=d(null),o=d(null),{pressed:s}=ne(),e=T({x:0,y:0,normX:0,normY:0,pressed:s,inside:!1});q(()=>{t.value.addEventListener("mousemove",n);const{isOutside:r}=se(o);g(r,a=>{e.inside=!a})});function n(r,a=t.value,l=o.value){if(!a)return;var u=a.createSVGPoint();u.x=r.clientX,u.y=r.clientY;let i=u.matrixTransform(a.getScreenCTM().inverse());if(l){let c=l.getBBox();e.x=i.x<c.width?i.x<0?0:i.x:c.width,e.y=i.y<c.height?i.y<0?0:i.y:c.height,e.normY=1-e.y/c.height,e.normX=e.x/c.width}else e.x=i.x,e.y=i.y}return{svg:t,area:o,mouse:e}}function ue(){const{svg:t,area:o,mouse:s}=oe(),e=T({pair:null,num:null,pub:null,x:O(()=>s.normX),y:O(()=>1-s.normY)}),n=T({next:0,max:10,list:{}});h.get("playersNext").on(a=>n.next=a),h.get("players").map().on((a,l)=>{a!=null&&(n.list[l]=R({},a))});async function r(){e.pair=await U.pair(),e.pub=e.pair.pub,e.num=n.next%n.max;const a=h.get("players").get(e.num);g(s,u=>{a.put({x:u.normX,y:1-u.normY})}),setInterval(()=>{a.get("pulse").put(Date.now())},500);let l={pub:e.pair.pub,pulse:Date.now(),x:s.normX,y:1-s.normY};a.put(l),h.get("playersNext").put(e.num+1)}return{svg:t,area:o,players:n,my:e,join:r}}const ae={class:"flex flex-col p-4"},re={class:"text-2xl font-bold"},le=Q("Map"),ie=["transform"],ce=f("circle",{fill:"red",r:"4"},null,-1),de=[ce],pe={class:"players"},ve=["transform"],fe=f("circle",{r:"10"},null,-1),me=[fe],he={class:"p-4"},ge={class:"p-4"},_e={setup(t){const{svg:o,area:s,my:e,players:n,join:r}=ue();return(a,l)=>(x(),y("div",ae,[f("div",re,[le,f("button",{class:"p-4 shadow-xl",onClick:l[0]||(l[0]=u=>m(r)())},"Join")]),(x(),y("svg",{class:"m-4 shadow-xl rounded-xl",ref:(u,i)=>{i.svg=u,S(o)&&(o.value=u)},version:"1.1",baseProfile:"full",viewBox:"0 0 1000 1000",xmlns:"http://www.w3.org/2000/svg","font-family":"Commissioner , sans-serif","text-anchor":"middle","dominant-baseline":"middle"},[f("rect",{ref:(u,i)=>{i.area=u,S(s)&&(s.value=u)},x:"2",y:"0",width:"1000",height:"1000",fill:"none","stroke-width":"0",opacity:"0.5"},null,512),f("g",{class:"me",transform:`translate(${m(e).x*1e3} ${m(e).y*1e3})`},de,8,ie),f("g",pe,[(x(!0),y(z,null,K(m(n).list,u=>(x(),y("g",{class:"player",key:u,transform:`translate(${u.x*1e3} ${u.y*1e3})`},me,8,ve))),128))])],512)),f("div",he,$(m(e)),1),f("div",ge,$(m(n)),1)]))}};export{_e as default};
